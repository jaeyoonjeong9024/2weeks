import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.pipeline import make_pipeline  # ğŸ‘ˆ íŒŒì´í”„ë¼ì¸ ë„êµ¬ ì¶”ê°€
from sklearn.tree import DecisionTreeRegressor
from sklearn.ensemble import RandomForestRegressor
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score

# -----------------------------
# 1) ë°ì´í„° ì¤€ë¹„
# -----------------------------
df = pd.read_csv("/content/drive/MyDrive/boston.csv", index_col=0)

X = df.drop(columns=["PRICE"])
y = df["PRICE"]

# â­ï¸ 1. ìŠ¤ì¼€ì¼ë§ ì „ì— ì›ë³¸ ë°ì´í„°ë¥¼ ë°”ë¡œ í•™ìŠµìš©ê³¼ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# -----------------------------
# 2) ëª¨ë¸ êµ¬ì„± (íšŒê·€ ëª¨ë¸)
# -----------------------------
# ê²°ì • íŠ¸ë¦¬ì™€ ëœë¤ í¬ë ˆìŠ¤íŠ¸ëŠ” ìŠ¤ì¼€ì¼ë§ì˜ ì˜í–¥ì´ ì ìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
dt_reg = DecisionTreeRegressor(random_state=42)
rf_reg = RandomForestRegressor(n_estimators=200, random_state=42)

# â­ï¸ 2. StandardScalerì™€ LinearRegressionì„ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ë¬¶ìŠµë‹ˆë‹¤.
# ì´ì œ lr_reg ëª¨ë¸ì€ ë°ì´í„°ë¥¼ ë°›ìœ¼ë©´ ì•Œì•„ì„œ ìŠ¤ì¼€ì¼ë§ í›„ í•™ìŠµ/ì˜ˆì¸¡ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
lr_reg = make_pipeline(StandardScaler(), LinearRegression())

# -----------------------------
# 3) ëª¨ë¸ í•™ìŠµ
# -----------------------------
# dt_regì™€ rf_regëŠ” ì›ë³¸(ë¶„í• ëœ) ë°ì´í„°ë¡œ í•™ìŠµí•©ë‹ˆë‹¤.
dt_reg.fit(X_train, y_train)
rf_reg.fit(X_train, y_train)
# lr_regëŠ” íŒŒì´í”„ë¼ì¸ ë‚´ë¶€ì—ì„œ X_trainì„ ìŠ¤ì¼€ì¼ë§í•œ í›„ í•™ìŠµí•©ë‹ˆë‹¤.
lr_reg.fit(X_train, y_train)

# -----------------------------
# 4) ëª¨ë¸ í‰ê°€ í•¨ìˆ˜
# -----------------------------
def eval_reg(y_true, y_pred):
    mae  = mean_absolute_error(y_true, y_pred)
    mse = mean_squared_error(y_true, y_pred)
    rmse = np.sqrt(mse)
    r2   = r2_score(y_true, y_pred)
    return mae, rmse, r2

# ê° ëª¨ë¸ì˜ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ í‰ê°€ í•¨ìˆ˜ë¡œ ê³„ì‚°
dt_mae, dt_rmse, dt_r2 = eval_reg(y_test, dt_reg.predict(X_test))
rf_mae, rf_rmse, rf_r2 = eval_reg(y_test, rf_reg.predict(X_test))
lr_mae, lr_rmse, lr_r2 = eval_reg(y_test, lr_reg.predict(X_test))

# -----------------------------
# 5) ê²°ê³¼ ì¶œë ¥
# -----------------------------
print("=== Test Metrics (Regression) ===")
print("[Decision Tree]")
print(f"MAE: {dt_mae:.3f} | RMSE: {dt_rmse:.3f} | R^2: {dt_r2:.3f}\n")

print("[Random Forest]")
print(f"MAE: {rf_mae:.3f} | RMSE: {rf_rmse:.3f} | R^2: {rf_r2:.3f}\n")

print("[Linear Regression with Pipeline]")
print(f"MAE: {lr_mae:.3f} | RMSE: {lr_rmse:.3f} | R^2: {lr_r2:.3f}")
