import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.tree import DecisionTreeRegressor       # ğŸ‘ˆ íšŒê·€ ëª¨ë¸ë¡œ ë³€ê²½
from sklearn.ensemble import RandomForestRegressor   # ğŸ‘ˆ íšŒê·€ ëª¨ë¸ë¡œ ë³€ê²½
from sklearn.linear_model import LinearRegression      # ğŸ‘ˆ íšŒê·€ ëª¨ë¸ë¡œ ë³€ê²½
from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score # ğŸ‘ˆ íšŒê·€ìš© í‰ê°€ ë„êµ¬

# -----------------------------
# 1) ë°ì´í„° ì¤€ë¹„
# -----------------------------
# diabetes.csv íŒŒì¼ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
df = pd.read_csv("/content/drive/MyDrive/diabetes.csv")

# â­ï¸ 1. ë¬¸ì œì§€ì™€ ì •ë‹µì§€ë¥¼ ìƒˆë¡œ ì •ì˜í•©ë‹ˆë‹¤.
# ë¬¸ì œì§€(X): ì •ë‹µì¸ 'BMI'ì™€ ë¶ˆí•„ìš”í•œ 'Outcome' ì»¬ëŸ¼ì„ ëª¨ë‘ ì œì™¸í•œ ë°ì´í„°
X = df.drop(columns=["BMI", "Outcome"])
# ì •ë‹µì§€(y): ìš°ë¦¬ê°€ ì˜ˆì¸¡í•˜ë ¤ëŠ” ëª©í‘œì¸ 'BMI' ì»¬ëŸ¼ ë°ì´í„°
y = df["BMI"]

# í”¼ì²˜ ìŠ¤ì¼€ì¼ë§ (StandardScaler)
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# â­ï¸ 2. stratify=y ì˜µì…˜ì„ ì œê±°í•˜ê³  ë°ì´í„°ë¥¼ ë¶„ë¦¬í•©ë‹ˆë‹¤.
# stratify ì˜µì…˜ì€ ë¶„ë¥˜ ë¬¸ì œì—ì„œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
X_train, X_test, y_train, y_test = train_test_split(
    X_scaled, y, test_size=0.2, random_state=42
)

# -----------------------------
# 2) ëª¨ë¸ êµ¬ì„± (íšŒê·€ ëª¨ë¸)
# -----------------------------
# â­ï¸ 3. ëª¨ë“  ëª¨ë¸ì„ íšŒê·€(Regressor)ìš©ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
dt_reg = DecisionTreeRegressor(random_state=42)
rf_reg = RandomForestRegressor(n_estimators=200, random_state=42)
lr_reg = LinearRegression()

# -----------------------------
# 3) ëª¨ë¸ í•™ìŠµ
# -----------------------------
dt_reg.fit(X_train, y_train)
rf_reg.fit(X_train, y_train)
lr_reg.fit(X_train, y_train)

# -----------------------------
# 4) ëª¨ë¸ í‰ê°€
# -----------------------------
# â­ï¸ 4. í‰ê°€ ë°©ì‹ë„ íšŒê·€ì— ë§ëŠ” ì˜¤ì°¨(MAE, RMSE, RÂ²) ì¸¡ì •ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
dt_pred = dt_reg.predict(X_test)
rf_pred = rf_reg.predict(X_test)
lr_pred = lr_reg.predict(X_test)

print("=== Test Metrics (BMI Prediction w/o Outcome) ===")
print(f"[Decision Tree]\nMAE: {mean_absolute_error(y_test, dt_pred):.3f} | RMSE: {np.sqrt(mean_squared_error(y_test, dt_pred)):.3f} | R^2: {r2_score(y_test, dt_pred):.3f}\n")
print(f"[Random Forest]\nMAE: {mean_absolute_error(y_test, rf_pred):.3f} | RMSE: {np.sqrt(mean_squared_error(y_test, rf_pred)):.3f} | R^2: {r2_score(y_test, rf_pred):.3f}\n")
print(f"[Linear Regression]\nMAE: {mean_absolute_error(y_test, lr_pred):.3f} | RMSE: {np.sqrt(mean_squared_error(y_test, lr_pred)):.3f} | R^2: {r2_score(y_test, lr_pred):.3f}")
